<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&amp;rsquo;s namespace. A good source of inspiration is Kotlin&amp;rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://marcellogalhardo.dev/blog/2020/02/01/naming-factory-methods/><title>Naming Factory Methods :: Marcello Galhardo â€” Senior Software Engineer @ N26</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.d7bdd8ee18bfbf4c605488a7e5b1b92cd980dfeed2bdaeab4dd5e931a7a78bc0.css><meta itemprop=name content="Naming Factory Methods"><meta itemprop=description content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider."><meta itemprop=datePublished content="2020-02-01T09:02:50+01:00"><meta itemprop=dateModified content="2020-02-01T09:02:50+01:00"><meta itemprop=wordCount content="493"><meta itemprop=image content="https://marcellogalhardo.dev/"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://marcellogalhardo.dev/"><meta name=twitter:title content="Naming Factory Methods"><meta name=twitter:description content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider."><meta property="article:published_time" content="2020-02-01 09:02:50 +0100 +0100"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>marcellogalhardo.dev</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/blog/>Blog</a></li><li><a href=/talks>Talks</a></li><li><a href=/about>About</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://marcellogalhardo.dev/blog/2020/02/01/naming-factory-methods/>Naming Factory Methods</a></h2><div class=post-content><p>When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.</p><h2 id=wrapping-an-instance>Wrapping an instance</h2><p>If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a <code>ViewModelProvider.Factory</code> that internally uses a <code>javax.inject.Provider</code>: you want a wrapper. Looking inside Kotlin&rsquo;s Standard library, we can find <a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/as-executor.html>asExecutor</a> which does the same.</p><p>Here is an example on how it could look like:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>VM</span> : <span style=color:#a6e22e>ViewModel</span>&gt; <span style=color:#a6e22e>Provider</span>&lt;<span style=color:#66d9ef>out</span> VM&gt;.asViewModelFactory(): ViewModelProvider.Factory {
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>ViewModelProvider</span>.Factory {
        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span> : <span style=color:#a6e22e>ViewModel</span>?&gt; <span style=color:#a6e22e>create</span>(modelClass: Class&lt;T&gt;): T {
            <span style=color:#a6e22e>@Suppress</span>(<span style=color:#e6db74>&#34;UNCHECKED_CAST&#34;</span>)
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>get</span>() <span style=color:#66d9ef>as</span> T
        }
    }
}
</code></pre></div><h2 id=mapping-data>Mapping data</h2><p>If you intend to get a given instance and copy its data to a different format, for example, a <code>UserResponse</code> (DTO) to a <code>User</code> (domain entity): you want a mapper. Again, Kotlin&rsquo;s Standard library gives us a good example with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/to-list.html?_ga=2.130355144.672183661.1577982073-802284527.1577800392">toList</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>UserDto</span>.toUser(): User {
    <span style=color:#66d9ef>return</span> User(
        name = Name(
            first = <span style=color:#66d9ef>this</span>.firstName,
            last = <span style=color:#66d9ef>this</span>.lastName
        ),
        email = Email(<span style=color:#66d9ef>this</span>.email)
        age = <span style=color:#66d9ef>this</span>.age
    )
}
</code></pre></div><h2 id=vararg-constructors>Vararg constructors</h2><p>If you need to provide a secondary constructor which accepts an unknown number of elements: you want a collection wrapper. For that, you can use a <code>vararg</code> method that returns the new composed object without polluting your class definition with an optional requirement. Kotlin&rsquo;s Standard Library offers us the convenient <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/list-of.html?_ga=2.139095028.672183661.1577982073-802284527.1577800392">listOf</a> as an example.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>controllerOf</span>(<span style=color:#66d9ef>vararg</span> controllers: Controller): Controller {
    <span style=color:#66d9ef>return</span> CompositeController(controllers)
}
</code></pre></div><h2 id=builders>Builders</h2><p>Kotlin&rsquo;s constructor combined with the named parameter covers most use cases of the Builder Design Pattern. However, sometimes you might want to create an instance where constructors are not suitable, with many optional parameters and configurable attributes where developers should be able to create alternative combinations highly configurable. Then, we can look to <a href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.text/build-string.html>buildString</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>inline</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>buildImageLoader</span>(
    builderAction: ImageLoaderBuilder.() <span style=color:#f92672>-&gt;</span> Unit
): String

<span style=color:#75715e>// usage example
</span><span style=color:#75715e></span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#66d9ef>val</span> imageLoader = buildImageLoader {
        uri = validUri <span style=color:#75715e>// receives a valid URI object
</span><span style=color:#75715e></span>        loadingPlaceholder = R.drawable.loading_placeholder
        errorPlaceholder = R.drawable.error_placeholder
        <span style=color:#75715e>// Many other possibilities.
</span><span style=color:#75715e></span>    }
}
</code></pre></div><h2 id=fake-constructors-aka-factory-methods>Fake Constructors (aka, Factory Methods)</h2><p>Sometimes you need to provide a secondary constructor that takes advantage of <code>inline</code> or <code>reified</code>. Those are not available for a constructor, but it does not mean we can&rsquo;t use them for constructing objects. Let&rsquo;s have a look into <a href=https://github.com/Kotlin/kotlinx.coroutines/blob/master/kotlinx-coroutines-core/common/src/flow/StateFlow.kt#L187>MutableStateFlow</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>MutableStateFlow</span>&lt;T&gt; {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>var</span> value: T
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>compareAndSet</span>(<span style=color:#66d9ef>expect</span>: T, update: T): Boolean
}

<span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span>&gt; <span style=color:#a6e22e>MutableStateFlow</span>(value: T): MutableStateFlow&lt;T&gt; {
    <span style=color:#66d9ef>return</span> StateFlowImpl(value <span style=color:#f92672>?:</span> NULL)
}
</code></pre></div><h1 id=conclusion>Conclusion</h1><p>As you can see, the Kotlin Standard library can be a good source of inspiration when designing code aiming for better discoverability between Kotlin Developers. Kotlin is a consistent language, and we can use it in our favor. Why not take advantage of that?</p></div></article><hr><div class=post-info></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span><span><a href=https://marcellogalhardo.dev/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js integrity="sha512-LOZOpupEpysT3YEvwutcyj7+h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script></body></html>