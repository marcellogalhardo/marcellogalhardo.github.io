<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Naming Factory Methods - Marcello</title>
<meta name=description content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider.">
<meta name=author content>
<link rel="preload stylesheet" as=style href=https://marcellogalhardo.dev/app.min.css>
<link rel="preload stylesheet" as=style href=https://marcellogalhardo.dev/an-old-hope.min.css>
<script defer src=https://marcellogalhardo.dev/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://marcellogalhardo.dev/theme.png>
<link rel=preload as=image href=https://marcellogalhardo.dev/twitter.svg>
<link rel=preload as=image href=https://marcellogalhardo.dev/github.svg>
<link rel=icon href=https://marcellogalhardo.dev/favicon.ico>
<link rel=apple-touch-icon href=https://marcellogalhardo.dev/apple-touch-icon.png>
<meta name=generator content="Hugo 0.88.1">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-7LK7ENB813','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<meta property="og:title" content="Naming Factory Methods">
<meta property="og:description" content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://marcellogalhardo.dev/posts/2020/02/01/naming-factory-methods/"><meta property="og:image" content="https://marcellogalhardo.dev/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-02-01T09:02:50+01:00">
<meta property="article:modified_time" content="2020-02-01T09:02:50+01:00"><meta property="og:site_name" content="Marcello">
<meta itemprop=name content="Naming Factory Methods">
<meta itemprop=description content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider."><meta itemprop=datePublished content="2020-02-01T09:02:50+01:00">
<meta itemprop=dateModified content="2020-02-01T09:02:50+01:00">
<meta itemprop=wordCount content="499"><meta itemprop=image content="https://marcellogalhardo.dev/">
<meta itemprop=keywords content="android,kotlin,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://marcellogalhardo.dev/">
<meta name=twitter:title content="Naming Factory Methods">
<meta name=twitter:description content="When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.
Wrapping an instance If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a ViewModelProvider.">
</head>
<body class=not-ready data-menu=true>
<header class=header>
<p class=logo>
<a class=site-name href=https://marcellogalhardo.dev/>Marcello</a><a class=btn-dark></a>
</p>
<script>let bodyClx=document.body.classList,btnDark=document.querySelector('.btn-dark'),sysDark=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark'),setDark=a=>{bodyClx[a?'add':'remove']('dark'),localStorage.setItem('dark',a?'yes':'no')};setDark(darkVal?darkVal==='yes':sysDark.matches),requestAnimationFrame(()=>bodyClx.remove('not-ready')),btnDark.addEventListener('click',()=>setDark(!bodyClx.contains('dark'))),sysDark.addEventListener('change',a=>setDark(a.matches))</script>
<nav class=menu>
<a href=/posts/>Posts</a>
<a href=/talks>Talks</a>
<a href=/about>About</a>
<a href=/uses>Uses</a>
</nav>
<nav class=social>
<a class=twitter style=--url:url(./twitter.svg) href=https://twitter.com/https://twitter.com/marcellogalhard target=_blank></a>
<a class=github style=--url:url(./github.svg) href=https://github.com/https://github.com/marcellogalhardo target=_blank></a>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-title>
<p>
<time>Feb 1, 2020</time>
</p>
<h1>Naming Factory Methods</h1>
</header>
<section class=post-content><p>When talking about Factory Methods, extension functions tend to be favored in Kotlin - but it might be a challenge to name these functions in a discoverable way without polluting your project&rsquo;s namespace. A good source of inspiration is Kotlin&rsquo;s Standard library: it contains many examples we can use as a base when deciding how to design a function.</p>
<h2 id=wrapping-an-instance>Wrapping an instance</h2>
<p>If you intend to get a given instance and adapt to one different object to follow another contract, for example, creating a <code>ViewModelProvider.Factory</code> that internally uses a <code>javax.inject.Provider</code>: you want a wrapper. Looking inside Kotlin&rsquo;s Standard library, we can find <a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/as-executor.html>asExecutor</a> which does the same.</p>
<p>Here is an example on how it could look like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>VM</span> : <span style=color:#a6e22e>ViewModel</span>&gt; <span style=color:#a6e22e>Provider</span>&lt;<span style=color:#66d9ef>out</span> VM&gt;.asViewModelProviderFactory(): ViewModelProvider.Factory {
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>object</span> <span style=color:#960050;background-color:#1e0010>: </span><span style=color:#a6e22e>ViewModelProvider</span>.Factory {
        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span> : <span style=color:#a6e22e>ViewModel</span>?&gt; <span style=color:#a6e22e>create</span>(modelClass: Class&lt;T&gt;): T {
            <span style=color:#a6e22e>@Suppress</span>(<span style=color:#e6db74>&#34;UNCHECKED_CAST&#34;</span>)
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>get</span>() <span style=color:#66d9ef>as</span> T
        }
    }
}
</code></pre></div><h2 id=mapping-data>Mapping data</h2>
<p>If you intend to get a given instance and copy its data to a different format, for example, a <code>UserResponse</code> (DTO) to a <code>User</code> (domain entity): you want a mapper. Again, Kotlin&rsquo;s Standard library gives us a good example with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/to-list.html?_ga=2.130355144.672183661.1577982073-802284527.1577800392">toList</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>UserDto</span>.toUser(): User {
    <span style=color:#66d9ef>return</span> User(
        name = Name(
            first = <span style=color:#66d9ef>this</span>.firstName,
            last = <span style=color:#66d9ef>this</span>.lastName
        ),
        email = Email(<span style=color:#66d9ef>this</span>.email),
        age = <span style=color:#66d9ef>this</span>.age
    )
}
</code></pre></div><h2 id=vararg-constructors>Vararg constructors</h2>
<p>If you need to provide a secondary constructor which accepts an unknown number of elements: you want a collection wrapper. For that, you can use a <code>vararg</code> method that returns the new composed object without polluting your class definition with an optional requirement. Kotlin&rsquo;s Standard Library offers us the convenient <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/list-of.html?_ga=2.139095028.672183661.1577982073-802284527.1577800392">listOf</a> as an example.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>controllerOf</span>(<span style=color:#66d9ef>vararg</span> controllers: Controller): Controller {
    <span style=color:#66d9ef>return</span> CompositeController(controllers)
}
</code></pre></div><h2 id=builders>Builders</h2>
<p>Kotlin&rsquo;s constructor combined with the named parameter covers most use cases of the Builder Design Pattern. However, sometimes you might want to create an instance where constructors are not suitable, with many optional parameters and configurable attributes where developers should be able to create alternative combinations highly configurable. Then, we can look to <a href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.text/build-string.html>buildString</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>inline</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>buildImageLoader</span>(
    builderAction: ImageLoaderBuilder.() <span style=color:#f92672>-&gt;</span> Unit
): String

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ImageLoaderBuilder</span>(
    <span style=color:#66d9ef>var</span> uri: URI,
    <span style=color:#a6e22e>@DrawableRes</span> <span style=color:#66d9ef>var</span> loadingPlaceholder: Int?,
    <span style=color:#a6e22e>@DrawableRes</span> <span style=color:#66d9ef>var</span> loadingPlaceholder: Int?,
    <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>)

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ImageLoader</span>

<span style=color:#75715e>// usage example
</span><span style=color:#75715e></span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#66d9ef>val</span> imageLoader = buildImageLoader {
        uri = validUri
        loadingPlaceholder = R.drawable.loading_placeholder
        errorPlaceholder = R.drawable.error_placeholder
        <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>    }
}
</code></pre></div><h2 id=fake-constructors-aka-factory-methods>Fake Constructors (aka, Factory Methods)</h2>
<p>Sometimes you need to provide a secondary constructor that takes advantage of <code>reified</code> or exposes an interface as a concrete type and hides the implementation: we can use a function named a class. Let&rsquo;s have a look into <a href=https://github.com/Kotlin/kotlinx.coroutines/blob/master/kotlinx-coroutines-core/common/src/flow/StateFlow.kt#L187>MutableStateFlow</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>MutableStateFlow</span>&lt;T&gt; {
    <span style=color:#66d9ef>var</span> value: T
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>compareAndSet</span>(<span style=color:#66d9ef>expect</span>: T, update: T): Boolean
}

<span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span>&gt; <span style=color:#a6e22e>MutableStateFlow</span>(value: T): MutableStateFlow&lt;T&gt; {
    <span style=color:#66d9ef>return</span> StateFlowImpl(value <span style=color:#f92672>?:</span> NULL)
}
</code></pre></div><h1 id=conclusion>Conclusion</h1>
<p>As you can see, the Kotlin Standard library can be a good source of inspiration when designing code aiming for better discoverability between Kotlin Developers. Kotlin is a consistent language, and we can use it in our favor. Why not take advantage of that?</p>
</section>
<footer class=post-tags>
<a href=https://marcellogalhardo.dev/tags/android>android</a>
<a href=https://marcellogalhardo.dev/tags/kotlin>kotlin</a>
</footer>
<nav class=post-nav>
<a class=prev href=https://marcellogalhardo.dev/posts/2021/02/01/humble-views-proud-viewmodels/><span>‚Üê</span><span>Humble Views, Proud ViewModels</span></a>
</nav>
</article>
</main>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span>&copy; 2021</span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span><span><a href=https://marcellogalhardo.dev/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
</footer>
</body>
</html>