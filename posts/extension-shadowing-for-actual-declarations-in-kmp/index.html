<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Extension Shadowing for Actual Declarations in KMP | Marcello Galhardo</title><meta name=keywords content="android,kotlin"><meta name=description content="Heads-up: this article assumes familiarity with Kotlin&rsquo;s [extension functions][extension-fun] and [expect and actual declarations][expect-actual] in [Kotlin Multiplatform (KMP)][kmp].
My work has recently focused on &ldquo;commonizing&rdquo;1 APIs, and I came across [KT-70012][KT-70012], which I believe merits attention.
In Kotlin JVM development, the EXTENSION_SHADOWED_BY_MEMBER warning indicates that an extension function is redundant, as it will always be overshadowed by a member function with the same name when invoked. However, in [KMP][kmp], this behaviour can be useful, as shadowing may occur on some platforms but not all."><meta name=author content><link rel=canonical href=https://marcellogalhardo.dev/posts/extension-shadowing-for-actual-declarations-in-kmp/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://marcellogalhardo.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://marcellogalhardo.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://marcellogalhardo.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://marcellogalhardo.dev/apple-touch-icon.png><link rel=mask-icon href=https://marcellogalhardo.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-7LK7ENB813"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7LK7ENB813",{anonymize_ip:!1})}</script><meta property="og:title" content="Extension Shadowing for Actual Declarations in KMP"><meta property="og:description" content="Heads-up: this article assumes familiarity with Kotlin&rsquo;s [extension functions][extension-fun] and [expect and actual declarations][expect-actual] in [Kotlin Multiplatform (KMP)][kmp].
My work has recently focused on &ldquo;commonizing&rdquo;1 APIs, and I came across [KT-70012][KT-70012], which I believe merits attention.
In Kotlin JVM development, the EXTENSION_SHADOWED_BY_MEMBER warning indicates that an extension function is redundant, as it will always be overshadowed by a member function with the same name when invoked. However, in [KMP][kmp], this behaviour can be useful, as shadowing may occur on some platforms but not all."><meta property="og:type" content="article"><meta property="og:url" content="https://marcellogalhardo.dev/posts/extension-shadowing-for-actual-declarations-in-kmp/"><meta property="og:image" content="https://marcellogalhardo.dev/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-07T15:49:00+01:00"><meta property="article:modified_time" content="2024-11-07T15:49:00+01:00"><meta property="og:site_name" content="Marcello Galhardo"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://marcellogalhardo.dev/logo.png"><meta name=twitter:title content="Extension Shadowing for Actual Declarations in KMP"><meta name=twitter:description content="Heads-up: this article assumes familiarity with Kotlin&rsquo;s [extension functions][extension-fun] and [expect and actual declarations][expect-actual] in [Kotlin Multiplatform (KMP)][kmp].
My work has recently focused on &ldquo;commonizing&rdquo;1 APIs, and I came across [KT-70012][KT-70012], which I believe merits attention.
In Kotlin JVM development, the EXTENSION_SHADOWED_BY_MEMBER warning indicates that an extension function is redundant, as it will always be overshadowed by a member function with the same name when invoked. However, in [KMP][kmp], this behaviour can be useful, as shadowing may occur on some platforms but not all."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://marcellogalhardo.dev/posts/"},{"@type":"ListItem","position":2,"name":"Extension Shadowing for Actual Declarations in KMP","item":"https://marcellogalhardo.dev/posts/extension-shadowing-for-actual-declarations-in-kmp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Extension Shadowing for Actual Declarations in KMP","name":"Extension Shadowing for Actual Declarations in KMP","description":"Heads-up: this article assumes familiarity with Kotlin\u0026rsquo;s [extension functions][extension-fun] and [expect and actual declarations][expect-actual] in [Kotlin Multiplatform (KMP)][kmp].\nMy work has recently focused on \u0026ldquo;commonizing\u0026rdquo;1 APIs, and I came across [KT-70012][KT-70012], which I believe merits attention.\nIn Kotlin JVM development, the EXTENSION_SHADOWED_BY_MEMBER warning indicates that an extension function is redundant, as it will always be overshadowed by a member function with the same name when invoked. However, in [KMP][kmp], this behaviour can be useful, as shadowing may occur on some platforms but not all.","keywords":["android","kotlin"],"articleBody":"Heads-up: this article assumes familiarity with Kotlin’s [extension functions][extension-fun] and [expect and actual declarations][expect-actual] in [Kotlin Multiplatform (KMP)][kmp].\nMy work has recently focused on “commonizing”1 APIs, and I came across [KT-70012][KT-70012], which I believe merits attention.\nIn Kotlin JVM development, the EXTENSION_SHADOWED_BY_MEMBER warning indicates that an extension function is redundant, as it will always be overshadowed by a member function with the same name when invoked. However, in [KMP][kmp], this behaviour can be useful, as shadowing may occur on some platforms but not all.\nStarting with Kotlin 2.1.0-Beta1, this warning will be removed in such cases. While this won’t change any behaviour, it will validate shadowing as a legitimate use case for [KMP][kmp].\nThis allows for effective strategies when commonizing existing APIs that need to remain backwards compatible, especially those not initially developed with Kotlin in mind.\nLet’s explore a naive use case for Android: [Bundle.putBoolean(String?, Boolean)][bundle-putboolean]\n// Common expect class Bundle expect fun Bundle.putBoolean(key: String, value: Boolean)  // Android actual typealias Bundle = android.os.Bundle actual inline fun Bundle.putBoolean(key: String, value: Boolean) {  putBoolean(key, value) }  // Non-Android actual class Bundle(map: Map) actual fun Bundle.putBoolean(key: String, value: Boolean) {  map[key] = value } Let’s break this down:\n expect class Bundle is an opaque type with no members in commonMain. expect fun Bundle.putBoolean(key, value) matches the signature of the original putBoolean method, but changes the first parameter from String? to String. On Android, the actual extension function is an inline function and will not exist at runtime. On non-Android platforms, the actual extension function is a regular function.  With this setup:\n On Android, putBoolean won’t exist at runtime and will always be superseded by the member function. On other platforms, the extension function will be utilized instead. It enables stricter types for shadowed members (e.g., changing key: String? to key: String since the types are compatible). The new type alias remains backwards compatible with existing APIs.  The EXTENSION_SHADOWED_BY_MEMBER warning is expected to be removed in Kotlin version 2.1.0. I hope to see more documentation on extension shadowing for actual declarations and clarification on what we can expect from the final bytecode on platforms where methods are shadowed — will the method be fully removed, or will it simply adjust the namespace?\nFor now, however, it remains an interesting concept to explore in side projects.\nReferences\n [KT-70012][KT-70012] [KT-69799][KT-69799]    Commonization refers to making an API available in the Kotlin Multiplatform common source sets across multiple platforms. [kmp]: https://kotlinlang.org/docs/multiplatform.html [expect-actual]: https://kotlinlang.org/docs/multiplatform-expect-actual.html [extension-fun]: https://kotlinlang.org/docs/extensions.html [KT-70012]: https://youtrack.jetbrains.com/issue/KT-70012/EXTENSIONSHADOWEDBYMEMBER-shouldnt-be-reported-for-actual-declarations [KT-69799]: https://youtrack.jetbrains.com/issue/KT-69799#focus=Comments-27-10153878.0-0 [bundle-putboolean]: https://developer.android.com/reference/android/os/BaseBundle#putBoolean(java.lang.String,%20boolean) ↩︎\n   ","wordCount":"416","inLanguage":"en","datePublished":"2024-11-07T15:49:00+01:00","dateModified":"2024-11-07T15:49:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://marcellogalhardo.dev/posts/extension-shadowing-for-actual-declarations-in-kmp/"},"publisher":{"@type":"Organization","name":"Marcello Galhardo","logo":{"@type":"ImageObject","url":"https://marcellogalhardo.dev/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://marcellogalhardo.dev/ accesskey=h title="Marcello Galhardo (Alt + H)">Marcello Galhardo</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://marcellogalhardo.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://marcellogalhardo.dev/talks title=Talks><span>Talks</span></a></li><li><a href=https://marcellogalhardo.dev/about title=About><span>About</span></a></li><li><a href=https://marcellogalhardo.dev/uses title=Uses><span>Uses</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Extension Shadowing for Actual Declarations in KMP</h1><div class=post-meta><span title="2024-11-07 15:49:00 +0100 +0100">November 7, 2024</span></div></header><div class=post-content><p><strong>Heads-up:</strong> this article assumes familiarity with Kotlin&rsquo;s [extension functions][extension-fun] and [expect and actual declarations][expect-actual] in [Kotlin Multiplatform (KMP)][kmp].</p><p>My work has recently focused on &ldquo;commonizing&rdquo;<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> APIs, and I came across [KT-70012][KT-70012], which I believe merits attention.</p><p>In Kotlin JVM development, the <code>EXTENSION_SHADOWED_BY_MEMBER</code> warning indicates that an extension function is redundant, as it will always be overshadowed by a member function with the same name when invoked. However, in [KMP][kmp], this behaviour can be useful, as shadowing may occur on some platforms but not all.</p><p>Starting with Kotlin 2.1.0-Beta1, this warning will be removed in such cases. While this won&rsquo;t change any behaviour, it will validate shadowing as a legitimate use case for [KMP][kmp].</p><p>This allows for effective strategies when commonizing existing APIs that need to remain backwards compatible, especially those not initially developed with Kotlin in mind.</p><p>Let&rsquo;s explore a naive use case for Android: [Bundle.putBoolean(String?, Boolean)][bundle-putboolean]</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Common
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>expect</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bundle</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>expect</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Bundle</span>.putBoolean(key: String, value: Boolean)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Android
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>actual</span> <span style=color:#66d9ef>typealias</span> Bundle = android.os.Bundle
</span></span><span style=display:flex><span><span style=color:#66d9ef>actual</span> <span style=color:#66d9ef>inline</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Bundle</span>.putBoolean(key: String, value: Boolean) {
</span></span><span style=display:flex><span>  putBoolean(key, value)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Non-Android
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>actual</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bundle</span>(map: Map&lt;String, Any?&gt;)
</span></span><span style=display:flex><span><span style=color:#66d9ef>actual</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Bundle</span>.putBoolean(key: String, value: Boolean) {
</span></span><span style=display:flex><span>    map[key] = value
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Let’s break this down:</p><ol><li><code>expect class Bundle</code> is an opaque type with no members in <code>commonMain</code>.</li><li><code>expect fun Bundle.putBoolean(key, value)</code> matches the signature of the original <code>putBoolean</code> method, but changes the first parameter from <code>String?</code> to <code>String</code>.</li><li>On Android, the actual extension function is an inline function and will not exist at runtime.</li><li>On non-Android platforms, the actual extension function is a regular function.</li></ol><p>With this setup:</p><ul><li>On Android, <code>putBoolean</code> won&rsquo;t exist at runtime and will always be superseded by the member function.</li><li>On other platforms, the extension function will be utilized instead.</li><li>It enables stricter types for shadowed members (e.g., changing <code>key: String?</code> to <code>key: String</code> since the types are compatible).</li><li>The new type alias remains backwards compatible with existing APIs.</li></ul><p><img loading=lazy src=https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wmvc69m96nl1df0zcm1b.png alt="Image description"></p><p>The <code>EXTENSION_SHADOWED_BY_MEMBER</code> warning is expected to be removed in Kotlin version 2.1.0. I hope to see more documentation on extension shadowing for actual declarations and clarification on what we can expect from the final bytecode on platforms where methods are shadowed — will the method be fully removed, or will it simply adjust the namespace?</p><p>For now, however, it remains an interesting concept to explore in side projects.</p><p><strong>References</strong></p><ul><li>[KT-70012][KT-70012]</li><li>[KT-69799][KT-69799]</li></ul><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Commonization refers to making an API available in the Kotlin Multiplatform <code>common</code> source sets across multiple platforms.
[kmp]: <a href=https://kotlinlang.org/docs/multiplatform.html>https://kotlinlang.org/docs/multiplatform.html</a>
[expect-actual]: <a href=https://kotlinlang.org/docs/multiplatform-expect-actual.html>https://kotlinlang.org/docs/multiplatform-expect-actual.html</a>
[extension-fun]: <a href=https://kotlinlang.org/docs/extensions.html>https://kotlinlang.org/docs/extensions.html</a>
[KT-70012]: <a href=https://youtrack.jetbrains.com/issue/KT-70012/EXTENSIONSHADOWEDBYMEMBER-shouldnt-be-reported-for-actual-declarations>https://youtrack.jetbrains.com/issue/KT-70012/EXTENSIONSHADOWEDBYMEMBER-shouldnt-be-reported-for-actual-declarations</a>
[KT-69799]: <a href="https://youtrack.jetbrains.com/issue/KT-69799#focus=Comments-27-10153878.0-0">https://youtrack.jetbrains.com/issue/KT-69799#focus=Comments-27-10153878.0-0</a>
[bundle-putboolean]: <a href=https://developer.android.com/reference/android/os/BaseBundle#putBoolean(java.lang.String,%20boolean)>https://developer.android.com/reference/android/os/BaseBundle#putBoolean(java.lang.String,%20boolean)</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><footer class=post-footer><ul class=post-tags><li><a href=https://marcellogalhardo.dev/tags/android/>android</a></li><li><a href=https://marcellogalhardo.dev/tags/kotlin/>kotlin</a></li></ul></footer></article></main><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2024</span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span><span><a href=https://marcellogalhardo.dev/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></body></html>